#!/usr/bin/env node
!function(){const e=()=>{var e=require("tty"),t={bold:["1m","22m"],dim:["2m","22m"],italic:["3m","23m"],underline:["4m","24m"],inverse:["7m","27m"],black:["30m","39m"],red:["31m","39m"],green:["32m","39m"],yellow:["33m","39m"],blue:["34m","39m"],magenta:["35m","39m"],cyan:["36m","39m"],white:["37m","39m"],default:["39m","39m"],grey:["90m","39m"],bgBlack:["40m","49m"],bgRed:["41m","49m"],bgGreen:["42m","49m"],bgYellow:["43m","49m"],bgBlue:["44m","49m"],bgMagenta:["45m","49m"],bgCyan:["46m","49m"],bgWhite:["47m","49m"],bgDefault:["49m","49m"]};const s=e=>`[${e}`;var o=!process.env.NOCOLOR&&e.isatty(1)&&e.isatty(2);return Object.keys(t).forEach((function(e){Object.defineProperty(String.prototype,e,{get:function(){return o?s(t[e][0])+this+s(t[e][1]):this},enumerable:!1})})),t},t=("dev"===process.env.NODE_ENV||process.env.NODE_ENV,process.env.NODE_DEBUG_LOGGING),{exec:s}=require("child_process");var o,r,n="";const a=(...e)=>{t&&console.log(...e)},i=t=>{r.verbose&&console.log("options",r),((t,s)=>{e();require("tty");var o,r,n,a,i=process.stdout.columns||80,c=(process.stdout.rows,0),l=0,d=0,m=0;const p=e=>{e.metadata&&(e.description=e.metadata.description,e.version=e.metadata.version),parseInt(e.stargazers_count)>c&&(c=parseInt(e.stargazers_count)),parseInt(e.downloads)>l&&(l=parseInt(e.downloads)),e.name.length>d&&(d=e.name.length);var t=e.version?e.version.length:0;t>m&&(m=t)},u=(e,t)=>(p(e),p(t),parseInt(e.stargazers_count)<parseInt(t.stargazers_count)?1:-1),g=(e,t)=>(p(e),p(t),parseInt(e.downloads)<parseInt(t.downloads)?1:-1),f=["Stars","Downloads","Package","Description"].join(" "),v="-".padStart(f.length,"-"),h=e=>{if(!e.name)return!1;e.metadata&&(e.description=e.metadata.description,e.version=e.metadata.version);const t=e.name,a=(e.downloads||0).toString().padStart(r," "),c=(e.stargazers_count||0).toString().padStart(o," "),l=(e=>`(${e})`)(e.version||"0.0.0"),d=(e.description||"undefined").slice(0,i-n);return["downloads"===s.sort?c.default:c.yellow,"downloads"===s.sort?a.yellow:a.default,t.cyan.bold,l.dim.italic,d.default].join(" ")};a="downloads"===s.sort?t.sort(g):t.sort(u),o=c.toString().length,r=l.toString().length,pad_name=d,pad_version=m,n=8+o+r+pad_name+pad_version,(e=>{var t=[];for(item of(t.push(f.bold),t.push(v),e))t.push(h(item));console.log(t.join("\n"))})(a)})(t,r)},c=()=>{var e=process.env.PKG_OPTIONS||"{}";r=Object.assign({},l,JSON.parse(e)),a("Process Env:",process.env,"Options: ",r)},l={verbose:!1,sort:"stars",select:"packages"};c();var d=process.argv;a("before",r,o),(e=>{if(a("Args:",typeof e,e),!e)return!1;if(!Array.isArray(e))return"object"==typeof e&&Object.entries(e).length>0&&c(),!1;var t=e.shift();do{switch(a("start loop",t),t){case __filename:a("found this file, skipping",t),a("next arg",t);break;case"--help":console.log([["\n Atom Advanced Search","search, sort, and filtering tool for Atom apm packages"].join(" - "),["\n [USAGE]","apm-tool [options] <name>"].join("\n   "),["\n [SELECT OPTIONS]",["  --select-packages","Get packages (default)"].join("\t"),["  --select-themes","Get themes"].join("\t"),["  --select-featured","Get featured packages/themes (ignores name argument)"].join("\t")].join("\n   "),["\n [SORT OPTIONS]",["  --sort-stars","Sort by stars (default)"].join("\t"),["  --sort-downloads","Sort by downloads"].join("\t")].join("\n   "),["\n [GENRAL OPTIONS]",["  --help       ","Show this help menu"].join("\t"),["  --verbose    ","Show more information"].join("\t"),["  --nocolor    ","Disable color printing on output"].join("\t"),["  --version    ","Output package version number"].join("\t")].join("\n   "),[""]].join("\n")),a("help",t),process.exit(0);break;case"--version":version(),a("version",t),process.exit(0);break;case"--verbose":r.verbose=!0,a("verbose",t);case"--sort-stars":r.sort="stars",a("stars",t);break;case"--sort-downloads":r.sort="downloads",a("downloads",t);break;case"--select-packages":r.select="packages",a("stars",t);break;case"--select-themes":r.select="themes",a("themes",t);break;case"--select-featured":r.select="featured",a("featured",t);break;default:t.match(/^--/)?(a(`Notice: Argument '${t}' is unkown.`),a("unknown",t)):void 0===t?a("is undefined",t):t.length>0?(o=t,a("is query",t)):a("didnt match passing..",t),a("----end loop----\n",t)}}while(t=e.shift());a("stopping",e,t)})(d),process.stdin.isTTY?(a("after",r,o),((e,t)=>{let o=["apm","featured"===t.select?"featured":"search","--json","themes"===t.select?"--themes":"","featured"===t.select?"":e].join(" ");console.log(`Searching (${t.select}) apm for:`,e),console.log(o),s(`${o}`,(e,t,s)=>{if(e)console.error(`exec error: ${e}`);else{a(`stdout: ${t}`),a(`stderr: ${s}`);var o=JSON.parse(t.trim());i(o)}})})(o,r)):process.stdin.setEncoding("utf-8").on("readable",(function(){for(var e;e=process.stdin.read();)n+=e})).on("end",(function(){n=n.replace(/\n$/,""),(()=>{const e=Buffer.from(n).toString("utf-8");var t=JSON.parse(e.trim());a(t),i(t)})()}))}();
